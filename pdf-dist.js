const Base64Prefix="data:application/pdf;base64,";function readBlob(e){return new Promise(((a,t)=>{const n=new FileReader;n.addEventListener("load",(()=>a(n.result))),n.addEventListener("error",t),n.readAsDataURL(e)}))}async function printPDF(e){e=await readBlob(e);const a=atob(e.substring(Base64Prefix.length)),t=await pdfjsLib.getDocument({data:a}).promise,n=await t.getPage(1),i=n.getViewport({scale:window.devicePixelRatio}),o=document.createElement("canvas"),s=o.getContext("2d");o.height=i.height,o.width=i.width;const d={canvasContext:s,viewport:i};return n.render(d).promise.then((()=>o))}async function pdfToImage(e){const a=1/window.devicePixelRatio;return new fabric.Image(e,{id:"renderPDF",scaleX:a,scaleY:a})}pdfjsLib.GlobalWorkerOptions.workerSrc="https://mozilla.github.io/pdf.js/build/pdf.worker.js";const canvas=new fabric.Canvas("canvas");document.querySelector("input").addEventListener("change",(async e=>{canvas.requestRenderAll();const a=await printPDF(e.target.files[0]),t=await pdfToImage(a);canvas.setWidth(t.width/window.devicePixelRatio),canvas.setHeight(t.height/window.devicePixelRatio),canvas.setBackgroundImage(t,canvas.renderAll.bind(canvas))}));const sign=document.querySelector(".sign");console.log(sign),localStorage.getItem("image")&&(sign.src=localStorage.getItem("image")),sign.addEventListener("click",(()=>{sign.src&&fabric.Image.fromURL(sign.src,(function(e){e.top=400,e.scaleX=.5,e.scaleY=.5,canvas.add(e)}))}));const pdf=new jsPDF,download=document.querySelector(".download");download.addEventListener("click",(()=>{const e=canvas.toDataURL("image/png"),a=pdf.internal.pageSize.width,t=pdf.internal.pageSize.height;pdf.addImage(e,"png",0,0,a,t),pdf.save("download.pdf")}));